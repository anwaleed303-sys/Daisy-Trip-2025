<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daisy Trip 2025 - Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-green: #28a745;
            --dark-green: #1e7e34;
            --light-green: #d4edda;
            --accent-green: #20c997;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9f7ef 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .header h1 {
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--accent-green) 100%);
            color: white;
            font-weight: 600;
            padding: 1.25rem;
            border: none;
        }

        .btn-primary {
            background: var(--primary-green);
            border: none;
            padding: 0.6rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-success {
            background: var(--accent-green);
            border: none;
        }

        .btn-success:hover {
            background: #1ba87e;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--primary-green);
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }

        .table {
            background: white;
        }

        .table thead {
            background: var(--light-green);
            color: var(--dark-green);
        }

        .badge-pending {
            background: #ffc107;
            color: #000;
        }

        .badge-completed {
            background: var(--primary-green);
        }

        .badge-partial {
            background: #17a2b8;
        }

        .stats-card {
            background: white;
            border-left: 4px solid var(--primary-green);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        .stats-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-green);
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            margin: 0 0.2rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .filter-section {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        @media print {
            .no-print {
                display: none;
            }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--light-green);
            margin-bottom: 1rem;
        }

        .nav-tabs .nav-link {
            color: var(--dark-green);
            font-weight: 600;
        }

        .nav-tabs .nav-link.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .teacher-card {
            background: white;
            border-left: 4px solid #17a2b8;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        .teacher-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-bus"></i> Daisy Trip 2025</h1>
                    <p class="mb-0">Complete Trip Management System</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-light mb-2" onclick="generateCompletePDF()">
                        <i class="fas fa-file-pdf"></i> Complete Report
                    </button>
                    <button class="btn btn-light mb-2" onclick="generateAttendancePDF()">
                        <i class="fas fa-clipboard-check"></i> Attendance Sheet
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="students-tab" data-bs-toggle="tab" data-bs-target="#students"
                    type="button">
                    <i class="fas fa-graduation-cap"></i> Students
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="teachers-tab" data-bs-toggle="tab" data-bs-target="#teachers"
                    type="button">
                    <i class="fas fa-chalkboard-teacher"></i> Teachers
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabContent">
            <!-- Students Tab -->
            <div class="tab-pane fade show active" id="students" role="tabpanel">
                <!-- Statistics Dashboard -->
                <div class="row mb-4">
                    <div class="col-lg-2 col-md-4 col-sm-6">
                        <div class="stats-card">
                            <div class="stats-number" id="totalStudents">0</div>
                            <div class="text-muted">Total Students</div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6">
                        <div class="stats-card">
                            <div class="stats-number" id="schoolStudents">0</div>
                            <div class="text-muted">School Students</div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6">
                        <div class="stats-card">
                            <div class="stats-number" id="outsideStudents">0</div>
                            <div class="text-muted">Outside Students</div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6">
                        <div class="stats-card">
                            <div class="stats-number" id="maleStudents">0</div>
                            <div class="text-muted">Male Students</div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6">
                        <div class="stats-card">
                            <div class="stats-number" id="femaleStudents">0</div>
                            <div class="text-muted">Female Students</div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6">
                        <div class="stats-card">
                            <div class="stats-number" id="totalStudentAmount">Rs 0</div>
                            <div class="text-muted">Total Collection</div>
                        </div>
                    </div>
                </div>

                <!-- Add Student Form -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-user-plus"></i> Add New Student
                    </div>
                    <div class="card-body">
                        <form id="studentForm" onsubmit="addStudent(event)">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Student Name *</label>
                                    <input type="text" class="form-control" id="studentName" required>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Gender *</label>
                                    <select class="form-select" id="studentGender" required>
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Class *</label>
                                    <select class="form-select" id="studentClass" required>
                                        <option value="">Select Class</option>
                                        <option value="Nursery">Nursery</option>
                                        <option value="KG">KG</option>
                                        <option value="1st">1st</option>
                                        <option value="2nd">2nd</option>
                                        <option value="3rd">3rd</option>
                                        <option value="4th">4th</option>
                                        <option value="5th">5th</option>
                                        <option value="6th">6th</option>
                                        <option value="7th">7th</option>
                                        <option value="8th">8th</option>
                                        <option value="9th">9th</option>
                                        <option value="10th">10th</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Student Type *</label>
                                    <select class="form-select" id="studentType" required>
                                        <option value="">Select Type</option>
                                        <option value="School">School Student</option>
                                        <option value="Outside">Outside Student</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Payment Amount *</label>
                                    <select class="form-select" id="paymentAmountType" onchange="toggleCustomAmount()"
                                        required>
                                        <option value="">Select Amount</option>
                                        <option value="3000">Rs 3,000</option>
                                        <option value="custom">Custom Amount</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3" id="customAmountDiv" style="display: none;">
                                    <label class="form-label">Enter Custom Amount</label>
                                    <input type="number" class="form-control" id="paymentAmount" min="0">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Payment Status *</label>
                                    <select class="form-select" id="paymentStatus" required>
                                        <option value="">Select Status</option>
                                        <option value="Completed">Completed</option>
                                        <option value="Pending">Pending</option>
                                        <option value="Partial">Partial</option>
                                    </select>
                                </div>
                                <div class="col-12 mb-3">
                                    <label class="form-label">Notes (Optional)</label>
                                    <textarea class="form-control" id="studentNotes" rows="2"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Student
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="clearStudentForm()">
                                <i class="fas fa-eraser"></i> Clear Form
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="row align-items-end">
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Filter by Class</label>
                            <select class="form-select" id="filterClass" onchange="filterStudents()">
                                <option value="">All Classes</option>
                                <option value="Nursery">Nursery</option>
                                <option value="KG">KG</option>
                                <option value="1st">1st</option>
                                <option value="2nd">2nd</option>
                                <option value="3rd">3rd</option>
                                <option value="4th">4th</option>
                                <option value="5th">5th</option>
                                <option value="6th">6th</option>
                                <option value="7th">7th</option>
                                <option value="8th">8th</option>
                                <option value="9th">9th</option>
                                <option value="10th">10th</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Filter by Type</label>
                            <select class="form-select" id="filterType" onchange="filterStudents()">
                                <option value="">All Types</option>
                                <option value="School">School Students</option>
                                <option value="Outside">Outside Students</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Filter by Payment</label>
                            <select class="form-select" id="filterPayment" onchange="filterStudents()">
                                <option value="">All Status</option>
                                <option value="Completed">Completed</option>
                                <option value="Pending">Pending</option>
                                <option value="Partial">Partial</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-2">
                            <button class="btn btn-secondary w-100" onclick="resetFilters()">
                                <i class="fas fa-redo"></i> Reset Filters
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Students Table -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-users"></i> Student List</span>
                        <button class="btn btn-danger btn-sm" onclick="clearAllStudentData()">
                            <i class="fas fa-trash"></i> Clear All Data
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Name</th>
                                        <th>Gender</th>
                                        <th>Class</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Payment Status</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsTableBody">
                                    <tr>
                                        <td colspan="9">
                                            <div class="empty-state">
                                                <i class="fas fa-inbox"></i>
                                                <p>No students added yet. Start by adding your first student!</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teachers Tab -->
            <div class="tab-pane fade" id="teachers" role="tabpanel">
                <!-- Teacher Statistics -->
                <div class="row mb-4">
                    <div class="col-lg-3 col-md-6">
                        <div class="teacher-card">
                            <div class="stats-number" id="totalTeachers">0</div>
                            <div class="text-muted">Total Teachers</div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="teacher-card">
                            <div class="stats-number" id="maleTeachers">0</div>
                            <div class="text-muted">Male Teachers</div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="teacher-card">
                            <div class="stats-number" id="femaleTeachers">0</div>
                            <div class="text-muted">Female Teachers</div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="teacher-card">
                            <div class="stats-number" id="totalTeacherAmount">Rs 0</div>
                            <div class="text-muted">Total Collection</div>
                        </div>
                    </div>
                </div>

                <!-- Add Teacher Form -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-user-plus"></i> Add New Teacher
                    </div>
                    <div class="card-body">
                        <form id="teacherForm" onsubmit="addTeacher(event)">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Teacher Name *</label>
                                    <input type="text" class="form-control" id="teacherName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Gender *</label>
                                    <select class="form-select" id="teacherGender" required>
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Subject/Department</label>
                                    <input type="text" class="form-control" id="teacherSubject"
                                        placeholder="e.g., Mathematics, Science">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Payment Amount *</label>
                                    <select class="form-select" id="teacherAmountType"
                                        onchange="toggleTeacherCustomAmount()" required>
                                        <option value="">Select Amount</option>
                                        <option value="3000">Rs 3,000</option>
                                        <option value="custom">Custom Amount</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3" id="teacherCustomAmountDiv" style="display: none;">
                                    <label class="form-label">Enter Custom Amount</label>
                                    <input type="number" class="form-control" id="teacherAmount" min="0">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Payment Status *</label>
                                    <select class="form-select" id="teacherPaymentStatus" required>
                                        <option value="">Select Status</option>
                                        <option value="Completed">Completed</option>
                                        <option value="Pending">Pending</option>
                                        <option value="Partial">Partial</option>
                                    </select>
                                </div>
                                <div class="col-12 mb-3">
                                    <label class="form-label">Notes (Optional)</label>
                                    <textarea class="form-control" id="teacherNotes" rows="2"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Teacher
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="clearTeacherForm()">
                                <i class="fas fa-eraser"></i> Clear Form
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Teachers Table -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-chalkboard-teacher"></i> Teacher List</span>
                        <button class="btn btn-danger btn-sm" onclick="clearAllTeacherData()">
                            <i class="fas fa-trash"></i> Clear All Data
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Name</th>
                                        <th>Gender</th>
                                        <th>Subject/Department</th>
                                        <th>Amount</th>
                                        <th>Payment Status</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="teachersTableBody">
                                    <tr>
                                        <td colspan="8">
                                            <div class="empty-state">
                                                <i class="fas fa-inbox"></i>
                                                <p>No teachers added yet. Start by adding your first teacher!</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let students = [];
        let teachers = [];
        let editingStudentIndex = -1;
        let editingTeacherIndex = -1;

        // Load data on page load
        window.onload = function () {
            loadData();
            updateStatistics();
            renderStudentTable();
            renderTeacherTable();
        };

        function loadData() {
            const savedStudents = localStorage.getItem('daisyTripStudents');
            const savedTeachers = localStorage.getItem('daisyTripTeachers');
            if (savedStudents) {
                students = JSON.parse(savedStudents);
            }
            if (savedTeachers) {
                teachers = JSON.parse(savedTeachers);
            }
        }

        function saveStudents() {
            localStorage.setItem('daisyTripStudents', JSON.stringify(students));
        }

        function saveTeachers() {
            localStorage.setItem('daisyTripTeachers', JSON.stringify(teachers));
        }

        // Student Functions
        function addStudent(event) {
            event.preventDefault();

            const amountType = document.getElementById('paymentAmountType').value;
            let amount = 0;

            if (amountType === '3000') {
                amount = 3000;
            } else if (amountType === 'custom') {
                amount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            }

            const student = {
                id: Date.now(),
                name: document.getElementById('studentName').value,
                gender: document.getElementById('studentGender').value,
                class: document.getElementById('studentClass').value,
                type: document.getElementById('studentType').value,
                amount: amount,
                status: document.getElementById('paymentStatus').value,
                notes: document.getElementById('studentNotes').value
            };

            if (editingStudentIndex >= 0) {
                students[editingStudentIndex] = { ...students[editingStudentIndex], ...student };
                editingStudentIndex = -1;
            } else {
                students.push(student);
            }

            saveStudents();
            clearStudentForm();
            updateStatistics();
            renderStudentTable();

            showNotification('Student added successfully!', 'success');
        }

        function toggleCustomAmount() {
            const amountType = document.getElementById('paymentAmountType').value;
            const customDiv = document.getElementById('customAmountDiv');
            const customInput = document.getElementById('paymentAmount');

            if (amountType === 'custom') {
                customDiv.style.display = 'block';
                customInput.required = true;
            } else {
                customDiv.style.display = 'none';
                customInput.required = false;
                customInput.value = '';
            }
        }

        function clearStudentForm() {
            document.getElementById('studentForm').reset();
            document.getElementById('customAmountDiv').style.display = 'none';
            document.getElementById('paymentAmount').required = false;
            editingStudentIndex = -1;
        }

        function editStudent(index) {
            const student = students[index];
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentGender').value = student.gender;
            document.getElementById('studentClass').value = student.class;
            document.getElementById('studentType').value = student.type;

            if (student.amount === 3000) {
                document.getElementById('paymentAmountType').value = '3000';
                document.getElementById('customAmountDiv').style.display = 'none';
            } else {
                document.getElementById('paymentAmountType').value = 'custom';
                document.getElementById('customAmountDiv').style.display = 'block';
                document.getElementById('paymentAmount').value = student.amount;
                document.getElementById('paymentAmount').required = true;
            }

            document.getElementById('paymentStatus').value = student.status;
            document.getElementById('studentNotes').value = student.notes || '';
            editingStudentIndex = index;

            // Switch to students tab and scroll to form
            document.getElementById('students-tab').click();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteStudent(index) {
            if (confirm('Are you sure you want to delete this student?')) {
                students.splice(index, 1);
                saveStudents();
                updateStatistics();
                renderStudentTable();
                showNotification('Student deleted successfully!', 'danger');
            }
        }

        function renderStudentTable() {
            const tbody = document.getElementById('studentsTableBody');
            const filterClass = document.getElementById('filterClass').value;
            const filterType = document.getElementById('filterType').value;
            const filterPayment = document.getElementById('filterPayment').value;

            let filtered = students.filter(student => {
                if (filterClass && student.class !== filterClass) return false;
                if (filterType && student.type !== filterType) return false;
                if (filterPayment && student.status !== filterPayment) return false;
                return true;
            });

            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9">
                            <div class="empty-state">
                                <i class="fas fa-search"></i>
                                <p>No students found matching your filters.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filtered.map((student, idx) => {
                const actualIndex = students.indexOf(student);
                const statusClass = student.status === 'Completed' ? 'badge-completed' :
                    student.status === 'Pending' ? 'badge-pending' : 'badge-partial';
                const genderIcon = student.gender === 'Male' ? 'fa-mars' : 'fa-venus';
                const genderColor = student.gender === 'Male' ? 'text-primary' : 'text-danger';
                return `
                    <tr>
                        <td>${idx + 1}</td>
                        <td><strong>${student.name}</strong></td>
                        <td><i class="fas ${genderIcon} ${genderColor}"></i> ${student.gender}</td>
                        <td><span class="badge bg-secondary">${student.class}</span></td>
                        <td><span class="badge bg-info">${student.type}</span></td>
                        <td><strong>Rs ${student.amount.toLocaleString()}</strong></td>
                        <td><span class="badge ${statusClass}">${student.status}</span></td>
                        <td>${student.notes || '-'}</td>
                        <td>
                            <i class="fas fa-edit text-primary action-btn" onclick="editStudent(${actualIndex})" title="Edit"></i>
                            <i class="fas fa-trash text-danger action-btn" onclick="deleteStudent(${actualIndex})" title="Delete"></i>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterStudents() {
            renderStudentTable();
        }

        function resetFilters() {
            document.getElementById('filterClass').value = '';
            document.getElementById('filterType').value = '';
            document.getElementById('filterPayment').value = '';
            renderStudentTable();
        }

        function clearAllStudentData() {
            if (confirm('Are you sure you want to delete all student data? This action cannot be undone!')) {
                students = [];
                saveStudents();
                updateStatistics();
                renderStudentTable();
                showNotification('All student data cleared!', 'warning');
            }
        }

        // Teacher Functions
        function addTeacher(event) {
            event.preventDefault();

            const amountType = document.getElementById('teacherAmountType').value;
            let amount = 0;

            if (amountType === '3000') {
                amount = 3000;
            } else if (amountType === 'custom') {
                amount = parseFloat(document.getElementById('teacherAmount').value) || 0;
            }

            const teacher = {
                id: Date.now(),
                name: document.getElementById('teacherName').value,
                gender: document.getElementById('teacherGender').value,
                subject: document.getElementById('teacherSubject').value,
                amount: amount,
                status: document.getElementById('teacherPaymentStatus').value,
                notes: document.getElementById('teacherNotes').value
            };

            if (editingTeacherIndex >= 0) {
                teachers[editingTeacherIndex] = { ...teachers[editingTeacherIndex], ...teacher };
                editingTeacherIndex = -1;
            } else {
                teachers.push(teacher);
            }

            saveTeachers();
            clearTeacherForm();
            updateStatistics();
            renderTeacherTable();

            showNotification('Teacher added successfully!', 'success');
        }

        function toggleTeacherCustomAmount() {
            const amountType = document.getElementById('teacherAmountType').value;
            const customDiv = document.getElementById('teacherCustomAmountDiv');
            const customInput = document.getElementById('teacherAmount');

            if (amountType === 'custom') {
                customDiv.style.display = 'block';
                customInput.required = true;
            } else {
                customDiv.style.display = 'none';
                customInput.required = false;
                customInput.value = '';
            }
        }

        function clearTeacherForm() {
            document.getElementById('teacherForm').reset();
            document.getElementById('teacherCustomAmountDiv').style.display = 'none';
            document.getElementById('teacherAmount').required = false;
            editingTeacherIndex = -1;
        }

        function editTeacher(index) {
            const teacher = teachers[index];
            document.getElementById('teacherName').value = teacher.name;
            document.getElementById('teacherGender').value = teacher.gender;
            document.getElementById('teacherSubject').value = teacher.subject || '';

            if (teacher.amount === 3000) {
                document.getElementById('teacherAmountType').value = '3000';
                document.getElementById('teacherCustomAmountDiv').style.display = 'none';
            } else {
                document.getElementById('teacherAmountType').value = 'custom';
                document.getElementById('teacherCustomAmountDiv').style.display = 'block';
                document.getElementById('teacherAmount').value = teacher.amount;
                document.getElementById('teacherAmount').required = true;
            }

            document.getElementById('teacherPaymentStatus').value = teacher.status;
            document.getElementById('teacherNotes').value = teacher.notes || '';
            editingTeacherIndex = index;

            // Switch to teachers tab and scroll to form
            document.getElementById('teachers-tab').click();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteTeacher(index) {
            if (confirm('Are you sure you want to delete this teacher?')) {
                teachers.splice(index, 1);
                saveTeachers();
                updateStatistics();
                renderTeacherTable();
                showNotification('Teacher deleted successfully!', 'danger');
            }
        }

        function renderTeacherTable() {
            const tbody = document.getElementById('teachersTableBody');

            if (teachers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>No teachers added yet. Start by adding your first teacher!</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = teachers.map((teacher, idx) => {
                const statusClass = teacher.status === 'Completed' ? 'badge-completed' :
                    teacher.status === 'Pending' ? 'badge-pending' : 'badge-partial';
                const genderIcon = teacher.gender === 'Male' ? 'fa-mars' : 'fa-venus';
                const genderColor = teacher.gender === 'Male' ? 'text-primary' : 'text-danger';
                return `
                    <tr>
                        <td>${idx + 1}</td>
                        <td><strong>${teacher.name}</strong></td>
                        <td><i class="fas ${genderIcon} ${genderColor}"></i> ${teacher.gender}</td>
                        <td>${teacher.subject || '-'}</td>
                        <td><strong>Rs ${teacher.amount.toLocaleString()}</strong></td>
                        <td><span class="badge ${statusClass}">${teacher.status}</span></td>
                        <td>${teacher.notes || '-'}</td>
                        <td>
                            <i class="fas fa-edit text-primary action-btn" onclick="editTeacher(${idx})" title="Edit"></i>
                            <i class="fas fa-trash text-danger action-btn" onclick="deleteTeacher(${idx})" title="Delete"></i>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function clearAllTeacherData() {
            if (confirm('Are you sure you want to delete all teacher data? This action cannot be undone!')) {
                teachers = [];
                saveTeachers();
                updateStatistics();
                renderTeacherTable();
                showNotification('All teacher data cleared!', 'warning');
            }
        }

        // Statistics
        function updateStatistics() {
            // Student Statistics
            const totalStudents = students.length;
            const schoolStudents = students.filter(s => s.type === 'School').length;
            const outsideStudents = students.filter(s => s.type === 'Outside').length;
            const maleStudents = students.filter(s => s.gender === 'Male').length;
            const femaleStudents = students.filter(s => s.gender === 'Female').length;
            const totalStudentAmount = students
                .filter(s => s.status === 'Completed')
                .reduce((sum, s) => sum + s.amount, 0);

            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('schoolStudents').textContent = schoolStudents;
            document.getElementById('outsideStudents').textContent = outsideStudents;
            document.getElementById('maleStudents').textContent = maleStudents;
            document.getElementById('femaleStudents').textContent = femaleStudents;
            document.getElementById('totalStudentAmount').textContent = `Rs ${totalStudentAmount.toLocaleString()}`;

            // Teacher Statistics
            const totalTeachers = teachers.length;
            const maleTeachers = teachers.filter(t => t.gender === 'Male').length;
            const femaleTeachers = teachers.filter(t => t.gender === 'Female').length;
            const totalTeacherAmount = teachers
                .filter(t => t.status === 'Completed')
                .reduce((sum, t) => sum + t.amount, 0);

            document.getElementById('totalTeachers').textContent = totalTeachers;
            document.getElementById('maleTeachers').textContent = maleTeachers;
            document.getElementById('femaleTeachers').textContent = femaleTeachers;
            document.getElementById('totalTeacherAmount').textContent = `Rs ${totalTeacherAmount.toLocaleString()}`;
        }

        // PDF Functions
        function generateCompletePDF() {
            if (students.length === 0 && teachers.length === 0) {
                alert('No data to generate report!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Title
            doc.setFontSize(20);
            doc.setTextColor(40, 167, 69);
            doc.text('Daisy Trip 2025', 105, 20, { align: 'center' });

            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('Complete Trip Management Report', 105, 28, { align: 'center' });
            doc.text(`Generated: ${new Date().toLocaleString()}`, 105, 35, { align: 'center' });

            let yPos = 45;

            // Students Section
            if (students.length > 0) {
                doc.setFontSize(16);
                doc.setTextColor(40, 167, 69);
                doc.text('STUDENTS SECTION', 105, yPos, { align: 'center' });
                yPos += 10;

                // Student Statistics
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Total Students: ${students.length}`, 20, yPos);
                doc.text(`School: ${students.filter(s => s.type === 'School').length}`, 70, yPos);
                doc.text(`Outside: ${students.filter(s => s.type === 'Outside').length}`, 110, yPos);
                doc.text(`Male: ${students.filter(s => s.gender === 'Male').length}`, 150, yPos);
                doc.text(`Female: ${students.filter(s => s.gender === 'Female').length}`, 180, yPos);
                yPos += 7;

                const totalStudentAmount = students.filter(s => s.status === 'Completed').reduce((sum, s) => sum + s.amount, 0);
                doc.text(`Total Collection (Completed): Rs ${totalStudentAmount.toLocaleString()}`, 20, yPos);
                yPos += 10;

                // Group by class
                const classes = ['Nursery', 'KG', '1st', '2nd', '3rd', '4th', '5th', '6th', '7th', '8th', '9th', '10th'];

                classes.forEach(cls => {
                    const classStudents = students.filter(s => s.class === cls);
                    if (classStudents.length > 0) {
                        doc.setFontSize(12);
                        doc.setTextColor(40, 167, 69);
                        doc.text(`Class: ${cls}`, 20, yPos);
                        yPos += 7;

                        const tableData = classStudents.map((s, i) => [
                            i + 1,
                            s.name,
                            s.gender,
                            s.type,
                            `Rs ${s.amount}`,
                            s.status,
                            s.notes || '-'
                        ]);

                        doc.autoTable({
                            startY: yPos,
                            head: [['#', 'Name', 'Gender', 'Type', 'Amount', 'Payment', 'Notes']],
                            body: tableData,
                            theme: 'grid',
                            headStyles: { fillColor: [40, 167, 69] },
                            margin: { left: 20, right: 20 },
                            styles: { fontSize: 9 }
                        });

                        yPos = doc.lastAutoTable.finalY + 10;

                        if (yPos > 270) {
                            doc.addPage();
                            yPos = 20;
                        }
                    }
                });
            }

            // Teachers Section
            if (teachers.length > 0) {
                if (yPos > 200) {
                    doc.addPage();
                    yPos = 20;
                }

                doc.setFontSize(16);
                doc.setTextColor(40, 167, 69);
                doc.text('TEACHERS SECTION', 105, yPos, { align: 'center' });
                yPos += 10;

                // Teacher Statistics
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Total Teachers: ${teachers.length}`, 20, yPos);
                doc.text(`Male: ${teachers.filter(t => t.gender === 'Male').length}`, 70, yPos);
                doc.text(`Female: ${teachers.filter(t => t.gender === 'Female').length}`, 120, yPos);
                yPos += 7;

                const totalTeacherAmount = teachers.filter(t => t.status === 'Completed').reduce((sum, t) => sum + t.amount, 0);
                doc.text(`Total Collection (Completed): Rs ${totalTeacherAmount.toLocaleString()}`, 20, yPos);
                yPos += 10;

                const teacherTableData = teachers.map((t, i) => [
                    i + 1,
                    t.name,
                    t.gender,
                    t.subject || '-',
                    `Rs ${t.amount}`,
                    t.status,
                    t.notes || '-'
                ]);

                doc.autoTable({
                    startY: yPos,
                    head: [['#', 'Name', 'Gender', 'Subject/Dept', 'Amount', 'Payment', 'Notes']],
                    body: teacherTableData,
                    theme: 'grid',
                    headStyles: { fillColor: [23, 162, 184] },
                    margin: { left: 20, right: 20 },
                    styles: { fontSize: 9 }
                });

                yPos = doc.lastAutoTable.finalY + 10;
            }

            // Grand Total
            if (yPos > 260) {
                doc.addPage();
                yPos = 20;
            }

            yPos += 10;
            doc.setFontSize(14);
            doc.setTextColor(40, 167, 69);
            doc.text('GRAND TOTAL', 105, yPos, { align: 'center' });
            yPos += 10;

            const grandTotal = students.filter(s => s.status === 'Completed').reduce((sum, s) => sum + s.amount, 0) +
                teachers.filter(t => t.status === 'Completed').reduce((sum, t) => sum + t.amount, 0);

            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Total Participants: ${students.length + teachers.length}`, 20, yPos);
            yPos += 7;
            doc.text(`Total Collection (Completed Payments): Rs ${grandTotal.toLocaleString()}`, 20, yPos);

            doc.save('Daisy_Trip_2025_Complete_Report.pdf');
            showNotification('Complete PDF Report Generated Successfully!', 'success');
        }

        function generateAttendancePDF() {
            const schoolStudents = students.filter(s => s.type === 'School');

            if (schoolStudents.length === 0 && teachers.length === 0) {
                alert('No school students or teachers to generate attendance sheet!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Title
            doc.setFontSize(20);
            doc.setTextColor(40, 167, 69);
            doc.text('Daisy Trip 2025', 105, 20, { align: 'center' });

            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('Attendance Sheet', 105, 28, { align: 'center' });
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 105, 35, { align: 'center' });

            let yPos = 45;

            // Students Section
            if (schoolStudents.length > 0) {
                doc.setFontSize(12);
                doc.setTextColor(40, 167, 69);
                doc.text('SCHOOL STUDENTS', 105, yPos, { align: 'center' });
                yPos += 7;

                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Total School Students: ${schoolStudents.length}`, 20, yPos);
                doc.text(`Male: ${schoolStudents.filter(s => s.gender === 'Male').length}`, 80, yPos);
                doc.text(`Female: ${schoolStudents.filter(s => s.gender === 'Female').length}`, 120, yPos);
                yPos += 10;

                const classes = ['Nursery', 'KG', '1st', '2nd', '3rd', '4th', '5th', '6th', '7th', '8th', '9th', '10th'];

                classes.forEach(cls => {
                    const classStudents = schoolStudents.filter(s => s.class === cls);
                    if (classStudents.length > 0) {
                        doc.setFontSize(11);
                        doc.setTextColor(40, 167, 69);
                        doc.text(`Class: ${cls} (${classStudents.length} students)`, 20, yPos);
                        yPos += 7;

                        const tableData = classStudents.map((s, i) => [
                            i + 1,
                            s.name,
                            s.gender,
                            ''
                        ]);

                        doc.autoTable({
                            startY: yPos,
                            head: [['#', 'Student Name', 'Gender', 'Present/Absent']],
                            body: tableData,
                            theme: 'grid',
                            headStyles: { fillColor: [40, 167, 69] },
                            margin: { left: 20, right: 20 },
                            styles: { fontSize: 10, cellPadding: 5 },
                            columnStyles: {
                                3: { cellWidth: 40 }
                            }
                        });

                        yPos = doc.lastAutoTable.finalY + 10;

                        if (yPos > 270) {
                            doc.addPage();
                            yPos = 20;
                        }
                    }
                });
            }

            // Teachers Section
            if (teachers.length > 0) {
                if (yPos > 200) {
                    doc.addPage();
                    yPos = 20;
                }

                doc.setFontSize(12);
                doc.setTextColor(23, 162, 184);
                doc.text('TEACHERS', 105, yPos, { align: 'center' });
                yPos += 7;

                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Total Teachers: ${teachers.length}`, 20, yPos);
                doc.text(`Male: ${teachers.filter(t => t.gender === 'Male').length}`, 80, yPos);
                doc.text(`Female: ${teachers.filter(t => t.gender === 'Female').length}`, 120, yPos);
                yPos += 10;

                const teacherTableData = teachers.map((t, i) => [
                    i + 1,
                    t.name,
                    t.gender,
                    t.subject || '-',
                    ''
                ]);

                doc.autoTable({
                    startY: yPos,
                    head: [['#', 'Teacher Name', 'Gender', 'Subject/Dept', 'Present/Absent']],
                    body: teacherTableData,
                    theme: 'grid',
                    headStyles: { fillColor: [23, 162, 184] },
                    margin: { left: 20, right: 20 },
                    styles: { fontSize: 10, cellPadding: 5 },
                    columnStyles: {
                        4: { cellWidth: 40 }
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;
            }

            // Signature section
            if (yPos > 250) {
                doc.addPage();
                yPos = 20;
            }

            yPos += 10;
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text('_________________________', 20, yPos + 20);
            doc.text('Teacher/Supervisor Signature', 20, yPos + 26);

            doc.text('_________________________', 110, yPos + 20);
            doc.text('Date', 110, yPos + 26);

            doc.save('Daisy_Trip_2025_Attendance_Sheet.pdf');
            showNotification('Attendance Sheet Generated Successfully!', 'success');
        }

        function showNotification(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3`;
            alertDiv.style.zIndex = '9999';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 3000);
        }
    </script>
</body>

</html>